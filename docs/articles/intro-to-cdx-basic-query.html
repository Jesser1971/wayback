<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Intro to the ‘CDX Basic Query’ Interface • wayback</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Intro to the ‘CDX Basic Query’ Interface">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">wayback</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro-to-cdx-basic-query.html">Intro to the 'CDX Basic Query' Interface</a>
    </li>
    <li>
      <a href="../articles/intro-to-mementos.html">Intro to Mementos</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/hrbrmstr/wayback">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Intro to the ‘CDX Basic Query’ Interface</h1>
                        <h4 class="author">Bob Rudis</h4>
            
            <h4 class="date">2018-09-18</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/hrbrmstr/wayback/blob/master/vignettes/intro-to-cdx-basic-query.Rmd"><code>vignettes/intro-to-cdx-basic-query.Rmd</code></a></small>
      <div class="hidden name"><code>intro-to-cdx-basic-query.Rmd</code></div>

    </div>

    
    
<p>When you make a resource query in the <a href="https://web.archive.org/">main Wayback web interface</a> you’re tapping into the <a href="https://github.com/internetarchive/wayback/tree/master/wayback-cdx-server">Wayback CDX API</a>. The <code><a href="../reference/cdx_basic_query.html">cdx_basic_query()</a></code> function in this package is a programmatic interface to that API.</p>
<p>An example use-case was presented in <a href="https://github.com/hrbrmstr/wayback/issues/3">GitHub Issue #3</a> where the issue originator desired to query for historical CSV files from <a href="https://www.maxmind.com/en/home">MaxMind</a>.</p>
<p>The <code><a href="../reference/cdx_basic_query.html">cdx_basic_query()</a></code> function has the following parameters (you must at least specify the <code>url</code> on your own):</p>
<ul>
<li>
<code>match_type</code>: “<code>exact</code>” (exact URL search)</li>
<li>
<code>collapse</code>: “<code>urlkey</code>” (only show unique URLs)</li>
<li>
<code>filter</code>: “<code>statuscode:200</code>” (only show resources with an HTTP 200 response code)</li>
<li>
<code>limit</code>: “<code>1e4L</code>” (return <code>10000</code> records; you can go higher)</li>
</ul>
<p>For <code>match_type</code>, if <code>url</code> is “<code>url: archive.org/about/</code>” then:</p>
<ul>
<li>“<code>exact</code>” will return results matching exactly <code>archive.org/about/</code>
</li>
<li>“<code>prefix</code>” will return results for all results under the path <code>archive.org/about/</code>
</li>
<li>“<code>host</code>” will return results from host <code>archive.org</code>
</li>
<li>“<code>domain</code>” will return results from host <code>archive.org</code> and all subhosts <code>*.archive.org</code>
</li>
</ul>
<p>For <code>collapse</code> the results returned are “collapsed” based on a field, or a substring of a field. Collapsing is done on adjacent cdx lines where all captures after the first one that are duplicate are filtered out. This is useful for filtering out captures that are ‘too dense’ or when looking for unique captures.</p>
<p>For now, <code>filter</code> is limited to a single expression. This will be enhanced at a later time.</p>
<p>To put the use-case into practice we’ll find CSV resources and download one of them:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(wayback)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">#&gt; Attaching package: 'dplyr'</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co">#&gt; The following objects are masked from 'package:stats':</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co">#&gt;     filter, lag</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co">#&gt; The following objects are masked from 'package:base':</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="co">#&gt;     intersect, setdiff, setequal, union</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="co"># query for maxmind prefix</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13">cdx &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cdx_basic_query.html">cdx_basic_query</a></span>(<span class="st">"http://maxmind.com/"</span>, <span class="st">"prefix"</span>)</a>
<a class="sourceLine" id="cb1-14" data-line-number="14"></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="co"># filter the returned results for CSV files</span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16">(csv &lt;-<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(cdx, <span class="kw">grepl</span>(<span class="st">"</span><span class="ch">\\</span><span class="st">.csv"</span>, original)))</a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="co">#&gt; # A tibble: 9 x 7</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18"><span class="co">#&gt;   urlkey   timestamp           original  mimetype statuscode digest length</span></a>
<a class="sourceLine" id="cb1-19" data-line-number="19"><span class="co">#&gt;   &lt;chr&gt;    &lt;dttm&gt;              &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;   &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb1-20" data-line-number="20"><span class="co">#&gt; 1 com,max… 2009-10-18 00:00:00 http://w… text/pl… 200        WGT2V… 9.57e2</span></a>
<a class="sourceLine" id="cb1-21" data-line-number="21"><span class="co">#&gt; 2 com,max… 2003-02-23 00:00:00 http://w… text/pl… 200        2QUN2… 5.60e2</span></a>
<a class="sourceLine" id="cb1-22" data-line-number="22"><span class="co">#&gt; 3 com,max… 2003-02-23 00:00:00 http://w… text/pl… 200        NTF24… 7.86e2</span></a>
<a class="sourceLine" id="cb1-23" data-line-number="23"><span class="co">#&gt; 4 com,max… 2006-01-11 00:00:00 http://w… text/pl… 200        OFDEL… 1.21e6</span></a>
<a class="sourceLine" id="cb1-24" data-line-number="24"><span class="co">#&gt; 5 com,max… 2006-06-20 00:00:00 http://w… text/pl… 200        3INKO… 1.16e6</span></a>
<a class="sourceLine" id="cb1-25" data-line-number="25"><span class="co">#&gt; 6 com,max… 2007-11-11 00:00:00 http://w… text/pl… 200        E2AT3… 2.95e6</span></a>
<a class="sourceLine" id="cb1-26" data-line-number="26"><span class="co">#&gt; 7 com,max… 2008-07-09 00:00:00 http://w… text/pl… 200        4YRNZ… 3.76e6</span></a>
<a class="sourceLine" id="cb1-27" data-line-number="27"><span class="co">#&gt; 8 com,max… 2008-08-13 00:00:00 http://w… text/pl… 200        HG7GQ… 3.85e6</span></a>
<a class="sourceLine" id="cb1-28" data-line-number="28"><span class="co">#&gt; 9 com,max… 2014-03-02 00:00:00 http://w… text/pl… 200        MW7F7… 3.26e4</span></a>
<a class="sourceLine" id="cb1-29" data-line-number="29"></a>
<a class="sourceLine" id="cb1-30" data-line-number="30"><span class="co"># examine a couple fields</span></a>
<a class="sourceLine" id="cb1-31" data-line-number="31">csv<span class="op">$</span>original[<span class="dv">9</span>]</a>
<a class="sourceLine" id="cb1-32" data-line-number="32"><span class="co">#&gt; [1] "http://www.maxmind.com:80/download/geoip/misc/region_codes.csv"</span></a>
<a class="sourceLine" id="cb1-33" data-line-number="33"></a>
<a class="sourceLine" id="cb1-34" data-line-number="34">csv<span class="op">$</span>timestamp[<span class="dv">9</span>]</a>
<a class="sourceLine" id="cb1-35" data-line-number="35"><span class="co">#&gt; [1] "2014-03-02 EST"</span></a>
<a class="sourceLine" id="cb1-36" data-line-number="36"></a>
<a class="sourceLine" id="cb1-37" data-line-number="37"><span class="co"># read the resource from that point in time using the "raw" </span></a>
<a class="sourceLine" id="cb1-38" data-line-number="38"><span class="co"># interface so as not to mangle the data.</span></a>
<a class="sourceLine" id="cb1-39" data-line-number="39">dat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/read_memento.html">read_memento</a></span>(csv<span class="op">$</span>original[<span class="dv">9</span>], <span class="kw">as.POSIXct</span>(csv<span class="op">$</span>timestamp[<span class="dv">9</span>]), <span class="st">"raw"</span>)</a>
<a class="sourceLine" id="cb1-40" data-line-number="40"></a>
<a class="sourceLine" id="cb1-41" data-line-number="41"><span class="co"># read it in</span></a>
<a class="sourceLine" id="cb1-42" data-line-number="42">readr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/readr/topics/read_delim">read_csv</a></span>(dat, <span class="dt">col_names =</span> <span class="kw">c</span>(<span class="st">"iso2c"</span>, <span class="st">"regcod"</span>, <span class="st">"name"</span>))</a>
<a class="sourceLine" id="cb1-43" data-line-number="43"><span class="co">#&gt; Parsed with column specification:</span></a>
<a class="sourceLine" id="cb1-44" data-line-number="44"><span class="co">#&gt; cols(</span></a>
<a class="sourceLine" id="cb1-45" data-line-number="45"><span class="co">#&gt;   iso2c = col_character(),</span></a>
<a class="sourceLine" id="cb1-46" data-line-number="46"><span class="co">#&gt;   regcod = col_character(),</span></a>
<a class="sourceLine" id="cb1-47" data-line-number="47"><span class="co">#&gt;   name = col_character()</span></a>
<a class="sourceLine" id="cb1-48" data-line-number="48"><span class="co">#&gt; )</span></a>
<a class="sourceLine" id="cb1-49" data-line-number="49"><span class="co">#&gt; # A tibble: 4,066 x 3</span></a>
<a class="sourceLine" id="cb1-50" data-line-number="50"><span class="co">#&gt;    iso2c regcod name               </span></a>
<a class="sourceLine" id="cb1-51" data-line-number="51"><span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;              </span></a>
<a class="sourceLine" id="cb1-52" data-line-number="52"><span class="co">#&gt;  1 AD    02     Canillo            </span></a>
<a class="sourceLine" id="cb1-53" data-line-number="53"><span class="co">#&gt;  2 AD    03     Encamp             </span></a>
<a class="sourceLine" id="cb1-54" data-line-number="54"><span class="co">#&gt;  3 AD    04     La Massana         </span></a>
<a class="sourceLine" id="cb1-55" data-line-number="55"><span class="co">#&gt;  4 AD    05     Ordino             </span></a>
<a class="sourceLine" id="cb1-56" data-line-number="56"><span class="co">#&gt;  5 AD    06     Sant Julia de Loria</span></a>
<a class="sourceLine" id="cb1-57" data-line-number="57"><span class="co">#&gt;  6 AD    07     Andorra la Vella   </span></a>
<a class="sourceLine" id="cb1-58" data-line-number="58"><span class="co">#&gt;  7 AD    08     Escaldes-Engordany </span></a>
<a class="sourceLine" id="cb1-59" data-line-number="59"><span class="co">#&gt;  8 AE    01     Abu Dhabi          </span></a>
<a class="sourceLine" id="cb1-60" data-line-number="60"><span class="co">#&gt;  9 AE    02     Ajman              </span></a>
<a class="sourceLine" id="cb1-61" data-line-number="61"><span class="co">#&gt; 10 AE    03     Dubai              </span></a>
<a class="sourceLine" id="cb1-62" data-line-number="62"><span class="co">#&gt; # ... with 4,056 more rows</span></a></code></pre></div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Bob Rudis.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
